<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ODP Style &amp; Standards (Draft) - Dataset Style</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">ODP Style &amp; Standards (Draft)</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./dataset-style.html" rel="" target="" aria-current="page">
 <span class="menu-text">Dataset Style</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./metadata-style.html" rel="" target="">
 <span class="menu-text">Metadata Style</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./metadata-standards.html" rel="" target="">
 <span class="menu-text">Metadata Standards</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-bi-github" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
      <i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-bi-github">    
        <li>
    <a class="dropdown-item" href="https://github.com/lsheble/style-guide" rel="" target="">
 <span class="dropdown-text">Source Code</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/lsheble/style-guide/issues" rel="" target="">
 <span class="dropdown-text">Report a Bug</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#dataset-content-structure" id="toc-dataset-content-structure" class="nav-link active" data-scroll-target="#dataset-content-structure">Dataset Content &amp; Structure</a>
  <ul class="collapse">
  <li><a href="#data-table-completeness" id="toc-data-table-completeness" class="nav-link" data-scroll-target="#data-table-completeness">Data Table Completeness</a>
  <ul class="collapse">
  <li><a href="#geospatial-and-address-fields" id="toc-geospatial-and-address-fields" class="nav-link" data-scroll-target="#geospatial-and-address-fields">Geospatial and Address Fields</a></li>
  </ul></li>
  <li><a href="#column-grouping-order" id="toc-column-grouping-order" class="nav-link" data-scroll-target="#column-grouping-order">Column Grouping &amp; Order</a></li>
  </ul></li>
  <li><a href="#naming-datasets-and-fields" id="toc-naming-datasets-and-fields" class="nav-link" data-scroll-target="#naming-datasets-and-fields">Naming Datasets and Fields</a>
  <ul class="collapse">
  <li><a href="#dataset-name" id="toc-dataset-name" class="nav-link" data-scroll-target="#dataset-name">Dataset Name</a>
  <ul class="collapse">
  <li><a href="#naming-convention" id="toc-naming-convention" class="nav-link" data-scroll-target="#naming-convention">Naming Convention</a></li>
  <li><a href="#formatting-casing-spacing-and-spellings" id="toc-formatting-casing-spacing-and-spellings" class="nav-link" data-scroll-target="#formatting-casing-spacing-and-spellings">Formatting: Casing, Spacing, and Spellings</a></li>
  </ul></li>
  <li><a href="#file-names-for-dataset-downloads" id="toc-file-names-for-dataset-downloads" class="nav-link" data-scroll-target="#file-names-for-dataset-downloads">File Names for Dataset Downloads</a></li>
  <li><a href="#field-names" id="toc-field-names" class="nav-link" data-scroll-target="#field-names">Field Names</a></li>
  <li><a href="#reserved-identifier-field-names" id="toc-reserved-identifier-field-names" class="nav-link" data-scroll-target="#reserved-identifier-field-names">Reserved identifier field names</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Dataset Style</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p>The Detroit Open Data Portal (ODP) is the primary gateway to current City of Detroit data that can be accessed through maps, data tables, dashboards, and applications designed to support the needs and interests of our primary user groups in the conduct of their everyday business and lives. Our primary user groups are represented in the following personas: Detroit Resident, Detroit Community Group, Detroit Businessperson, Detroit Researcher, City of Detroit Staff, and Detroit Public Administrator. <a href="https://data.detroitmi.gov/pages/personas">Information about ODP personas</a> is available through the Open Data Portal.</p>
<section id="dataset-content-structure" class="level1">
<h1>Dataset Content &amp; Structure</h1>
<ul>
<li><p><strong>Current data</strong>: Datasets on the ODP represent up-to-date official records that are created or actively used, referenced, or updated on a recurring basis during the current calendar or fiscal year as a part of the conduct of City of Detroit business.</p>
<ul>
<li><p>Recent and active records are relevant to the needs and interests of the majority of our primary user groups in the conduct of their everyday business and lives.</p></li>
<li><p><strong>Archive and Research Hub:</strong> Access to datasets that represent inactive and historical records retained by the City will be provided by a dedicated Archive and Research hub designed to promote access to datasets suited to retrospective, trend, and historical analyses and other uses focused on past or longer-term practices, states, and events.</p></li>
<li><p>Segmenting records represented in datasets by activity level enables us to better support access to data based on use cases.</p></li>
</ul></li>
<li><p><strong>Suitable for public access.</strong> Data resources must be reviewed to ensure alignment with security and privacy regulations, protocols, and practices before publication to the Open Data Portal.</p></li>
<li><p><strong>Raw data preferred:</strong> Datasets should represent the rawest (i.e., closest to original) form of data permitted for public use. Avoid unnecessarily aggregating or summarizing data by geographic, temporal, demographic, or other factors. Raw data supports a greater variety of secondary uses.</p></li>
<li><p><strong>Authoritative source preferred:</strong> For any given data field, the organizational unit or other entity that produces, captures, or is instrumental to the creation of that data is the preferred source.</p></li>
<li><p><strong>Parsimonious datasets:</strong> Each field should be represented in one and only one column. Extraneous fields may hamper the ability of users to compare and reference data values across fields if the fields are far apart or require the user to scroll horizontally to see them.</p>
<ul>
<li><strong>Exception:</strong> Street address components should be broken into separate component fields to enable filtering in the ODP. A separate field that contains all address components may also be included.</li>
</ul></li>
<li><p><strong>Clearly defined tables:</strong> There should be one table for each “kind” of record. For each table, you should be able to complete the sentence: “Each row in the table is a __________.” (e.g., “Inspection!”, “Park!”, “License!”).</p></li>
<li><p><strong>Geocoding:</strong> Detroit Base Units is the preferred geocoding resource.</p></li>
<li><p><strong>Data persistence:</strong> Information conveyed by a dataset at any given time should persist in the ODP across dataset updates. Though a general rule of thumb is to never delete (or replace) dataset values, the best approach to ensuring data persists may vary by dataset. For example:</p>
<ul>
<li><p>For datasets with fields that will change as an entity’s status changes, key dates associated with each status transition might be captured in a date field.</p></li>
<li><p>If a dataset consists of items or subsets of items associated with records in a second dataset, the relationship between the two datasets should be described and a URL link provided. A unique identifier should be available in each dataset so the datasets can be joined or merged. If an application or dashboard provides access to the datasets, include a reference and link to it in the dataset description.</p></li>
<li><p><strong>Exception:</strong> If a dataset’s values were removed or updated due to an error, it is not necessary to retain the erroneous dataset. What was wrong, what was done to correct the error, and relevant dates should be documented. If appropriate, the ‘fix’ can be communicated via the ODP Change Log.</p></li>
</ul></li>
<li><p><strong>Language should maintain meaning:</strong> When writing descriptions, naming columns, and so forth, language that has the same meaning when it is recorded and when it is (later) read by someone using the dataset should be used.</p>
<ul>
<li>For example, if the meaning of a relative reference to time (e.g., “now”, “this year”, “new”) is likely to eventually differ between when it was recorded and the time it is read, reference a specific year, date range, or other time unit instead. An exception to this principle would be if a category name includes a time-specific reference. For example, a building might be aptly described using a category such as “new construction”. &nbsp;In such cases, the category should be clearly defined.</li>
</ul></li>
<li><p><strong>Table usability:</strong> For tabular datasets that will be used primarily on the ODP, structure tables to enable people to perform common tasks. Common tasks include finding records that fit specific criteria, including looking up known items, and comparing values across and within records (Laubheimer, 2022).</p>
<ul>
<li><p>Most datasets that will be used directly in the Open Data Portal should be structured so that there is one row for each primary row entity. A “primary row entity” is whatever can be used to accurately complete the sentence, “Each row in the table is a _______.” This structure enables a person to see everything about an entity that is a member of the dataset by reading across a single row.</p></li>
<li><p>If it is necessary to have more than one row for one or more row entities in a dataset, this should be communicated clearly in the dataset description.</p></li>
</ul></li>
<li><p><strong>Application reference datasets.</strong> Datasets that correspond with a dashboard, application, or other resource should typically inherit the data structure of the parent resource. If the parent resource is very complex (with many fields) or very atomistic (with relatively few fields dispersed across many tables), it may be appropriate to restructure data to enhance table usability.</p>
<ul>
<li><p>Anticipated data uses and whether a dataset is downloadable directly from the parent resource should be considered when making decisions about restructuring a dataset.</p></li>
<li><p>In the dataset description provide a link to the dashboard, application, or other data resource the dataset is related to.</p></li>
</ul></li>
</ul>
<section id="data-table-completeness" class="level2">
<h2 class="anchored" data-anchor-id="data-table-completeness">Data Table Completeness</h2>
<ul>
<li><p><strong>Unique Identifier:</strong> All tables should include a unique identifier field that can be used to identify distinct records. This type of unique identifier is sometimes called a primary key.</p></li>
<li><p><strong>Join fields:</strong> If there are multiple related tables, each should include a column that allows the tables to be joined or merged. Typically, this is a unique identifier or “key” data field.</p></li>
<li><p><strong>Date or Datetime:</strong> If there is a date or datetime field that can be used to place records in time, include that field as a part of the dataset. Values that reflect record activity are best.</p></li>
<li><p><strong>Category code descriptions:</strong> If a field consists of numeric or similarly cryptic category codes, corresponding category labels or descriptions should be provided either in an adjacent, accompanying field or in the field description metadata.</p>
<ul>
<li>If the category is based on a resource such as a controlled vocabulary or industry standard, clearly identify the resource.</li>
</ul></li>
</ul>
<section id="geospatial-and-address-fields" class="level3">
<h3 class="anchored" data-anchor-id="geospatial-and-address-fields">Geospatial and Address Fields</h3>
<ul>
<li><p><strong>Street Address plus Zip Code:</strong> If a table includes a street address, the table should also include a corresponding 5-digit zip code.</p></li>
<li><p><strong>Addresses outside Detroit:</strong> If one or more addresses in a table are located outside the City of Detroit, that table should include all elements of a complete US address or, if appropriate, a complete international address.</p></li>
<li><p><strong>Geocoded location:</strong> When a table includes fields that identify multiple geographical locations, which location corresponds with geospatial fields should be clearly identified.</p></li>
</ul>
</section>
</section>
<section id="column-grouping-order" class="level2">
<h2 class="anchored" data-anchor-id="column-grouping-order">Column Grouping &amp; Order</h2>
<p>Columns should be presented in a meaningful order that reflects prevailing practices, relationships between columns, and the relative importance of fields included in the dataset. Column order affects table usability and interpretability. General guidelines include the following:</p>
<ul>
<li><p><strong>The unique identifier field should be the first</strong> (i.e., leftmost) field in the table.</p></li>
<li><p><strong>Importance:</strong> All else being equal, more important columns should be first (farther left).</p></li>
<li><p><strong>Related fields should be grouped together</strong> and follow general use conventions. For example:</p>
<ul>
<li><p>Latitude and Longitude columns should be adjacent, with latitude preceding longitude.</p></li>
<li><p>Address elements associated with a location should be grouped together and ordered according to standard USPS practice.</p></li>
<li><p>If different levels of a category scheme are allocated to separate fields, these fields should be grouped together. Typically, a broader or more inclusive category should precede a narrower or more exclusive category. That is, categories should precede related subcategories.</p></li>
<li><p>If more than one entity is described by columns in a table, group columns by entity. For example, if both a physical and a mailing address is present, group components of the physical address together and group components of the mailing address together.</p></li>
</ul></li>
<li><p><strong>Chronological order:</strong> If a row presents steps in a process, arrange columns to reflect the chronology of that process.</p></li>
<li><p><strong>Consistency across datasets:</strong> If two datasets have similar contents and creation contexts, similarities and differences in column order can signal similarities and differences between datasets. &nbsp;</p></li>
<li><p><strong>Industry standards:</strong> Fields of a standards-based or standards-aligned dataset should typically be ordered according to the specification of that standard.</p></li>
</ul>
<p>Special types of datasets may have a conventional structure that differs from one or more of these guidelines. For example, the first column in a time series dataset is typically a date or datetime variable. In such cases, it is appropriate to follow the conventional structure for the type of dataset.</p>
</section>
</section>
<section id="naming-datasets-and-fields" class="level1">
<h1>Naming Datasets and Fields</h1>
<p>The dataset name and field names are integral components of a dataset that describe and set expectations for what a dataset contains (Riederer, 2020). If a dataset is downloaded for later use in a format such as a comma separated value (CSV) file, these names are the only metadata included as a part of the dataset. Concise, descriptive names that consistently follow formatting guidelines help ensure users understand data and facilitate data integration and interoperability.</p>
<section id="dataset-name" class="level2">
<h2 class="anchored" data-anchor-id="dataset-name">Dataset Name</h2>
<p>We want datasets to have concise, descriptive, and consistently formatted names to help people identify and understand dataset content and relevance as they search and browse the ODP. Note: The dataset name is the “Title” In the dataset-level metadata.</p>
<section id="naming-convention" class="level3">
<h3 class="anchored" data-anchor-id="naming-convention">Naming Convention</h3>
<ul>
<li><p>Each dataset should have a unique name.</p></li>
<li><p>The name should indicate what a dataset is about, or the main topic the data represents.</p></li>
<li><p>Dataset names should be as short as possible while also being meaningful and conveying the distinctive nature of the data.</p></li>
<li><p>The default assumption is that a dataset includes the most up-to-date version of active records within a calendar year framework. If a dataset covers a fiscal rather than a calendar year, add “(Current FY)” to indicate the current fiscal year. If a dataset covers the most recent calendar year, the title should be followed by “(Current)”.</p></li>
<li><p>Archived datasets should be stored in a separate archive hub. Replace “(Current)” with the year or date range covered by the data. This year or date range should match the year or dates indicated in the “temporal coverage” field of the dataset-level metadata.</p></li>
</ul>
</section>
<section id="formatting-casing-spacing-and-spellings" class="level3">
<h3 class="anchored" data-anchor-id="formatting-casing-spacing-and-spellings">Formatting: Casing, Spacing, and Spellings</h3>
<ul>
<li><p>“Title Case” should be used. Ensure there are spaces between words for better readability.</p></li>
<li><p>Avoid using abbreviations and shortened words (e.g., instead of “demo”, use “demolition”).</p></li>
<li><p>Acronyms in the title should be expanded.</p></li>
</ul>
</section>
</section>
<section id="file-names-for-dataset-downloads" class="level2">
<h2 class="anchored" data-anchor-id="file-names-for-dataset-downloads">File Names for Dataset Downloads</h2>
<p>If a file is prepared so that users can download a dataset, the name of the file should be the equivalent of the dataset name, reformatted in “kebab-case”.</p>
<ul>
<li><p>Use lowercase alphanumeric characters (a-z, 0-9) and hyphens (-) only.</p></li>
<li><p>Spaces should be replaced by a hyphen.</p></li>
<li><p>Characters such as “&amp;” should be replaced with the equivalent word.</p></li>
<li><p>File names, like dataset names, should be short and meaningful. No file name should exceed 255 characters due to common system limitations. Most should be shorter: Long file names increase the likelihood of error and are more difficult to remember and recognize.</p></li>
<li><p>If relevant and supported by systems, add a version number or a version-relevant date stamp.</p></li>
</ul>
</section>
<section id="field-names" class="level2">
<h2 class="anchored" data-anchor-id="field-names">Field Names</h2>
<p>The field name is the machine-friendly column header in the underlying data table. In the ODP attribute metadata display, it is labeled “Name”, and in AGO, “Field Name”. Field names are retained in dataset files downloaded from the ODP and AGO.</p>
<ul>
<li><p>Use snake_case for field names.</p>
<ul>
<li><p>Separate words by underscores if there are multiple words.</p></li>
<li><p>Only lowercase alphanumeric characters and underscores are allowed.</p></li>
</ul></li>
<li><p>Field names should start with a letter.</p></li>
<li><p>Field names should be short and meaningful.</p></li>
<li><p>Field names should contribute to overall dataset usability. For example, rather than repeating a given descriptive word in every observation (i.e., value) of an attribute, consider including that word in the column name and excluding it from the value entries.</p></li>
</ul>
<p>Example field name from ODI Pit Dataset</p>
<div id="tbl-panel" class="tbl-parent quarto-layout-panel anchored">
<div class="panel-caption table-caption">
<p>Table&nbsp;1: Example field name from ODI Pit Dataset</p>
</div>
<div class="quarto-layout-row quarto-layout-valign-top">
<div id="tbl-first" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-panel" style="flex-basis: 50.0%;justify-content: center;">
<table class="table">
<caption>(a) Revision of column name and value format needed</caption>
<thead>
<tr class="header">
<th style="text-align: left;">size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Medium vault</td>
</tr>
<tr class="even">
<td style="text-align: left;">Small vault</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Small vault</td>
</tr>
<tr class="even">
<td style="text-align: left;">Large vault</td>
</tr>
</tbody>
</table>
</div>
<div id="tbl-second" class="quarto-layout-cell quarto-layout-cell-subref anchored" data-ref-parent="tbl-panel" style="flex-basis: 50.0%;justify-content: center;">
<table class="table">
<caption>(b) Preferred column name and value format</caption>
<thead>
<tr class="header">
<th style="text-align: left;">vault_size</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Medium</td>
</tr>
<tr class="even">
<td style="text-align: left;">Small</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Small</td>
</tr>
<tr class="even">
<td style="text-align: left;">Large</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="reserved-identifier-field-names" class="level2">
<h2 class="anchored" data-anchor-id="reserved-identifier-field-names">Reserved identifier field names</h2>
<p>The following field names must reference Official Detroit Base Units or Office of the Assessor Parcel IDs and should not be used as names for other fields.</p>
<ul>
<li><p>address_id</p></li>
<li><p>building_id</p></li>
<li><p>parcel_id</p></li>
<li><p>street_id</p></li>
<li><p>unit_id</p></li>
</ul>
</section>
</section>
<section id="references" class="level1">
<h1>References</h1>
<p>City of Detroit. (n.d.). <em>Open Data Portal Personas</em>. Detroit Open Data Portal. <a href="https://data.detroitmi.gov/pages/personas" class="uri">https://data.detroitmi.gov/pages/personas</a></p>
<p>Laubheimer, P. (2022, April 3). <em>Data tables: Four major user tasks</em>. Nielsen Norman Group. <a href="https://www.nngroup.com/articles/data-tables/" class="uri">https://www.nngroup.com/articles/data-tables/</a></p>
<p>Riederer, E. (2020, Sept.&nbsp;6). <em>Column names as contracts</em>. Emily Riederer. <a href="https://emilyriederer.netlify.app/post/column-name-contracts/" class="uri">https://emilyriederer.netlify.app/post/column-name-contracts/</a></p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>